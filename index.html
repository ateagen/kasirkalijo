<!DOCTYPE html>
<html>
<head>
  <title>Form Menu</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .menu-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; }
    button { padding: 5px 10px; }
  </style>
</head>
<body>

<h2>Daftar Menu</h2>
<div id="menuList"></div>

<h2>Tambah/Ubah Menu</h2>
<form id="menuForm">
  <input type="hidden" id="menuId">
  <input type="text" id="nama" placeholder="Nama menu" required>
  <input type="number" id="harga" placeholder="Harga" required>
  <input type="file" id="foto" accept="image/*">
  <button type="submit">Simpan</button>
</form>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby11vBG6vwkgFxjlbKdERvFGE9jAEy2k1CJIByN-fedGLtC71Pp6KzKBG0G9NIonzF2/exec"; // URL Web App Google Apps Script

async function loadMenu() {
  const res = await fetch(SCRIPT_URL);
  const data = await res.json();
  const menuDiv = document.getElementById("menuList");
  menuDiv.innerHTML = "";
  data.forEach(m => {
    menuDiv.innerHTML += `
      <div class="menu-item">
        <img src="${m.foto}" alt="${m.nama}">
        <b>${m.nama}</b> - Rp ${m.harga}
        <button onclick="editMenu(${m.id}, '${m.nama}', ${m.harga}, '${m.foto}')">Edit</button>
        <button onclick="deleteMenu(${m.id})">Hapus</button>
      </div>
    `;
  });
}

async function submitMenu(e) {
  e.preventDefault();
  const id = document.getElementById("menuId").value;
  const nama = document.getElementById("nama").value;
  const harga = document.getElementById("harga").value;
  const fotoFile = document.getElementById("foto").files[0];

  let fotoBase64 = "";
  if (fotoFile) {
    fotoBase64 = await toBase64(fotoFile);
  }

  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: id ? "update" : "add",
      id, nama, harga,
      foto: fotoBase64
    })
  });

  document.getElementById("menuForm").reset();
  loadMenu();
}

async function deleteMenu(id) {
  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ action: "delete", id })
  });
  loadMenu();
}

function editMenu(id, nama, harga, foto) {
  document.getElementById("menuId").value = id;
  document.getElementById("nama").value = nama;
  document.getElementById("harga").value = harga;
}

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
  });
}

document.getElementById("menuForm").addEventListener("submit", submitMenu);

loadMenu();
</script>

</body>
</html>
