<!DOCTYPE html>
<html>
<head>
  <title>Upload Foto ke Google Drive</title>
</head>
<body>
  <h2>Upload Foto</h2>
  <input type="file" id="fileInput" accept="image/*">
  <button onclick="uploadFile()">Upload</button>

  <h3>Foto Terupload:</h3>
  <div id="photoContainer"></div>

  <script>
    const webAppUrl = "https://script.google.com/macros/s/AKfycbwiq9kajtvKcwGfrlx7iszjQBBiXZGtcT303xx_g9jDyGSZJceI03M5LIP3V43KGbU1Uw/exec";

    // Tampilkan foto dari localStorage saat halaman dibuka
    window.onload = function() {
      const savedImage = localStorage.getItem("uploadedImage");
      if (savedImage) {
        showImage(savedImage);
      }
    };

    function uploadFile() {
      const fileInput = document.getElementById("fileInput").files[0];
      if (!fileInput) {
        alert("Pilih file dulu!");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const base64Data = e.target.result.split(",")[1];

        fetch(webAppUrl, {
          method: "POST",
          body: new URLSearchParams({
            file: base64Data,
            filename: fileInput.name,
            mimeType: fileInput.type
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.imageUrl) {
            localStorage.setItem("uploadedImage", data.imageUrl);
            showImage(data.imageUrl);
          } else {
            alert("Upload gagal: " + data.error);
          }
        })
        .catch(err => alert("Error: " + err));
      };
      reader.readAsDataURL(fileInput);
    }

    function showImage(url) {
      document.getElementById("photoContainer").innerHTML = `<img src="${url}" width="300">`;
    }
  </script>
</body>
</html>

